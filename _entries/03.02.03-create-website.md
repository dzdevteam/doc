---
sectionclass: h3
sectionid: ajenti-create-website
parent-id: using-ajenti
is-parent: no
title: Tạo website
---

Trong lần sử dụng Ajenti đầu tiên, có thể Ajenti V (chức năng quản lý website của Ajenti) chưa được bật. Khi đó nếu chọn `Websites` từ sidebar sẽ hiện ra thông báo như hình dưới và chỉ cần nhấn `Enable` là được.

![Ajenti V not enabled](img/server-administration/ajenti-v-not-enabled.png)

Sau khi đã bật Ajenti V, mục `Websites` sẽ có giao diện sau:

![Ajenti V websites](img/server-administration/ajenti-websites.png)

Để tạo một website mới, nhập tên của website (tên mang tính mô tả, không nhất thiết là tên miền) và mục `Name` trong `New Website` và nhấn `Create`. Sau đó một mục mới sẽ được tạo ra ở phần `Websites`, nhấn tiếp `Manage` để cấu hình cho website mới này.

![Ajenti V example](img/server-administration/ajenti-website-example.png)


#### Cấu hình thư mục

1. **Nếu thư mục đã có trên máy chủ:**
    Dùng nút duyệt ở bên cạnh ô `Path` để duyệt nhanh đến thư mục đó.
    
2. **Nếu muốn tạo thư mục mới:**
    Dùng nút duyệt ở bên cạnh ô `Path` để duyệt nhanh tới thư mục cha, ví dụ `/srv/`. Sau đó gõ tên của thư mục mới vào đằng sau đường dẫn hiện ra trong ô `Path`. Nhấn nút `Create Directory` để Ajenti tạo thư mục, sau đó nhấn nút `Fix Permissions` để sửa lại quyền của thư mục vừa tạo.
    **Khuyến cáo:** Nên để tất cả các website trong thư mục `/srv/`.
    
![Ajenti setting folder](img/server-administration/ajenti-website-setting-folder.png)

#### Cấu hình tên miền

Để đặt một tên miền cho trang web này, chọn thẻ `Domains`, nhấn `Add` để thêm một mục trong bảng tên miền, sau đó nhập tên miền mong muốn. Có thể có nhiều tên miền cho một thư mục.

*Việc cấu hình tên miền ở đây chỉ có tác dụng trong nội bộ máy chủ. Để một tên miền thực sự trỏ về máy chủ của mình, cần phải cấu hình DNS cho nó (việc này nằm ngoài giới hạn của tài liệu).*

![Ajenti setting domain](img/server-administration/ajenti-website-setting-domain.png)

#### Cấu hình PHP

Nếu trang web này sử dụng PHP thì sẽ cần phải cấu hình thêm bước này. Trong thẻ `Content`, chọn `PHP FastCGI` trong ô `[1]` sau đó nhấn nút `Create`. Một mục mới sẽ hiện ra trong bảng cấu hình ở phía trên như sau:

![Ajenti setting PHP](img/server-administration/ajenti-website-setting-php.png)

*Cấu hình riêng cho các trang dev:*

1. Trong mục `PHP FPM` chọn `Process Manager` là `On Demand` với `Max Processes` là 1.
2. Trong mục `PHP`, thêm đoạn thiết lập dưới đây để tắt theo dõi của NewRelic (cài sẵn trên máy chủ playdota.vn và dzdev.com) và bật hiển thị lỗi. Các thiết lập khác thuộc về `php.ini` cũng đều thêm vào mục này.
    
       newrelic.enabled = false;
       error_reporting = On;
       display_errors = On;

![Ajenti setting PHP dev](img/server-administration/ajenti-website-setting-php-dev.png)

*Cấu hình riêng cho các trang production:*

1. Trong mục `PHP FPM`:
    - `Process Manager` chọn `Dynamic`
    - `Min Processes` chọn 1 nếu trang traffic thấp, 3 trở lên nếu trang traffic cao.
    - `Max Processes` chọn 3 nếu trang traffic thấp, 7-8 trở lên nếu trang traffic cao. Luôn đặt tùy chọn này để tránh các trang chiếm dụng quá nhiều bộ nhớ khi traffic đột biến.
2. Trong mục `PHP`, thêm các thiết lập `php.ini` khác vào ô `PHP .ini values` tùy thuộc vào nhu cầu của ứng dụng sẽ chạy (VD: tăng `post_max_size`,...).

#### Cấu hình đường dẫn đẹp

Trong thẻ `Advanced`, ô `Custom configuration`, sao chép đoạn thiết lập sau để hỗ trợ tính năng đường dẫn đẹp của Joomla hay Wordpress (áp dụng cho cả các phần mềm khác như Drupal, vBulletin,...). Tác dụng của đoạn thiết lập này là máy chủ, nếu không tìm thấy tập tin hay thư mục nào phù hợp với đường dẫn, sẽ chuyển đường dẫn đó sang cho Joomla/Wordpress xử lý (chính là phần `$args` trong `/index.php?$args`).

    location / {
       try_files $uri $uri/ /index.php?$args;
    }
       
![Ajenti setting PHP advanced](img/server-administration/ajenti-website-setting-advanced.png)

#### Cấu hình tập tin tĩnh

Việc cấu hình đường dẫn đẹp sẽ dẫn tới hệ quả là tất cả các đường dẫn `not found` sẽ đều chuyển qua PHP xử lý, kể cả khi đường dẫn là các tập tin ảnh, js, css,... Khi đó để tránh làm giảm hiệu năng của website, cần phải cấu hình thêm tập tin tĩnh như sau:

1. Ở mục `[1]` chọn `Static files`, sau đó nhấn `Create`.
2. Ở mục `[3]` nhập vào đoạn sau (tự điều chỉnh tùy theo thực tế): `\.(js|css|png|jpeg|jpg|gif|eot|woff|svg)$`.
3. Ở mục `[4]` chọn `Regex`.
    
![Ajenti setting static](img/server-administration/ajenti-website-setting-static.png)
    
#### Cấu hình FTP

Tại thẻ `FTP`, một tên tài khoản và mật khẩu sẽ được tạo sẵn và có thể thay đổi tùy theo. Tài khoản này sẽ chỉ có quyền truy cập vào thư mục của trang web (cấu hình tại bước 1).

![Ajenti setting ftp](img/server-administration/ajenti-website-setting-ftp.png)

#### Cấu hình MySQL

Tại thẻ `MySQL`:

- Nếu muốn tạo một database mới, nhập tên mong muốn vào `[1]` và nhấn `Create`.
- Nếu database đã có sẵn, nhập tên của database đó vào `[1]` và nhấn `Attach`.
- Nếu muốn tạo người dùng mới cho các database của trang web này, nhập tên và mật khẩu vào `[3]` sau đó nhấn `Create`. Nhấn tiếp `Grant All Permissions` để các người dùng mới được quyền truy nhập vào cơ sở dữ liệu ở phía trên.

![Ajenti setting mysql](img/server-administration/ajenti-website-setting-mysql.png)

#### Bật, tắt và áp dụng thay đổi

Trong thẻ `General`:

* Ô `Enabled`: Chọn để cấu hình của trang web hiện tại có hiệu lực. Bỏ chọn, trang web sẽ tạm thời bị tắt đi (không còn truy cập được nữa).
* Ô `Maintenance mode`: Nếu không muốn tắt trang web mà chỉ cần hiển thị một trang thông báo bảo trì, hãy tích vào ô này và giữ nguyên ô `Enabled`. **Lưu ý là nếu đã cấu hình đường dẫn đẹp thì không sử dụng tính năng này được do xung đột cấu hình.**
* Nút `Delete`: Xóa hoàn toàn cấu hình của trang web ra khỏi Ajenti.

![Ajenti setting example](img/server-administration/ajenti-website-example.png)

Sau mỗi thay đổi cấu hình, luôn nhấn nút ![Apply Changes](img/server-administration/ajenti-apply-changes.png) và quay lại trang liệt kê `Websites` để kiểm tra xem các cấu hình PHP và Nginx có sai sót gì không. Một cấu hình không sai sót sẽ có kết quả kiểm tra như sau:

![Ajenti setting check](img/server-administration/ajenti-website-config-check.png)
